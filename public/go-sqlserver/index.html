<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.63.2" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script data-ad-client="ca-pub-8179589660494169" async
    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <title>æ­»ç£•ï¼ŒGo-Sql-Driveræ‰§è¡Œæµç¨‹ &middot; aliasliyu4</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="/css/poole.css">
  <link type="text/css" rel="stylesheet" href="/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class="theme-base-08 ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="/"><h1>aliasliyu4</h1></a>
      <p class="lead">
       ä¸å†æ˜¯å°‘å¹´ 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="/">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2020. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>æ­»ç£•ï¼ŒGo-Sql-Driveræ‰§è¡Œæµç¨‹</h1>
  <time datetime=2020-02-17T17:11:44&#43;0800 class="post-date">Mon, Feb 17, 2020</time>
  <p>Golangçš„database/sqlåŒ…å®šä¹‰äº†å¸¸ç”¨çš„æ“ä½œæ•°æ®çš„æ–¹æ³•ï¼Œä»–æä¾›äº†ä¸€ä¸ªæŠ½è±¡ï¼Œå…·ä½“çš„driverä¾èµ–ä¸åŒçš„æ•°æ®åº“ã€‚
æ¯”å¦‚mysqlé©±åŠ¨æ¯”è¾ƒæœ‰åçš„<a href="https://github.com/go-sql-driver/mysql" title="">MySql</a>ã€‚
è¿˜æœ‰Sql Serverä½¿ç”¨è¾ƒä¸ºå¹¿æ³›çš„åº“æ˜¯ <a href="https://github.com/denisenkom/go-mssqldb" title="">SqlServer</a>ã€‚
ä½¿ç”¨è€…åªéœ€è¦æä¾›DSN(data source name)æˆ–è€…tcpè¿æ¥, open() dbä¹‹åä¼šè¿”å›ä¸€ä¸ª*sql.DBå¯¹è±¡ã€‚DBæœ¬èº«æ²¡æœ‰è¿æ¥æ•°æ®åº“ï¼Œ
åªæœ‰å½“Query/Execä¹‹åæ‰ä¼šè¿æ¥æ•°æ®åº“ã€‚</p>
<p>å‡è®¾éœ€è¦ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span>(
    <span style="color:#e6db74">&#34;database/sql&#34;</span>
    <span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;github.com/denisenkom/go-mssqldb&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>(){
    <span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Connect</span>(<span style="color:#e6db74">&#34;mssql&#34;</span>, <span style="color:#a6e22e">dataSourceName</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;[db.GetSqlServer] open sql fail:%s&#34;</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>()))
	}

    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
        <span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
        <span style="color:#66d9ef">return</span>
    }
    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Close</span>()

    <span style="color:#a6e22e">rows</span>,<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;select top 1 foo, bar from test_table&#34;</span>)

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">foo</span> <span style="color:#a6e22e">bar</span> <span style="color:#66d9ef">string</span>
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">rows</span>.<span style="color:#a6e22e">Next</span>(){
        <span style="color:#a6e22e">_</span>,<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">row</span>.<span style="color:#a6e22e">Scan</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">foo</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">bar</span>)
        <span style="color:#66d9ef">if</span>  <span style="color:#a6e22e">err</span>  <span style="color:#f92672">!=</span>  <span style="color:#66d9ef">nil</span> {
            <span style="color:#75715e">// do something
</span><span style="color:#75715e"></span>        }
        <span style="color:#66d9ef">break</span>
    }
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>}

</code></pre></div><hr>
<p>å¼•å…¥äº†ä¸¤ä¸ªåŒ…ï¼Œä¸€ä¸ªæ˜¯<code>database/sql</code>, å¦å¤–ä¸€ä¸ªæ˜¯<code>_ &quot;github.com/denisenkom/go-mssqldb&quot;</code>ä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥è¿™ä¸¤ä¸ªåŒ…ï¼Ÿ
æˆ‘ä»¬çŸ¥é“åœ¨Golangä¸­åŒ…å‰é¢æœ‰ä¸‹åˆ’çº¿æ„å‘³ç€åªå¼•å…¥å…¶ä¸­çš„<code>init()</code>æ–¹æ³•, é‚£ä¹ˆgo-mssqldbçš„initæ–¹æ³•åšäº†äº›ä»€ä¹ˆ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// ç¬¬ä¸‰æ–¹åŒ…å®šä¹‰çš„driverå®ä½“
</span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">driverInstance</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Driver</span>{<span style="color:#a6e22e">processQueryText</span>: <span style="color:#66d9ef">true</span>}
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">driverInstanceNoProcess</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Driver</span>{<span style="color:#a6e22e">processQueryText</span>: <span style="color:#66d9ef">false</span>}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
    <span style="color:#75715e">// æ³¨å†Œåˆ°sqlä¸­ï¼Œç¨åæˆ‘ä»¬æ¥çœ‹ï¼Œæ³¨å†Œä¸€ä¸ªç»“æ„ä½“è¿›å»æœ‰ä»€ä¹ˆç”¨
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Register</span>(<span style="color:#e6db74">&#34;mssql&#34;</span>, <span style="color:#a6e22e">driverInstance</span>)
    <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Register</span>(<span style="color:#e6db74">&#34;sqlserver&#34;</span>, <span style="color:#a6e22e">driverInstanceNoProcess</span>)
    <span style="color:#75715e">// åˆå§‹åŒ–ä¸€ä¸ªå‡½æ•°ï¼Œ ç”¨ä½œå‘èµ·ç½‘ç»œè°ƒç”¨
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">createDialer</span> = <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">connectParams</span>) <span style="color:#a6e22e">Dialer</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">netDialer</span>{<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Dialer</span>{<span style="color:#a6e22e">KeepAlive</span>: <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">keepAlive</span>}}
	}
}

</code></pre></div><p>å¦‚ä¸Šçš„æ³¨å†Œä¸€ä¸ªmssqlé©±åŠ¨åˆ°sqlä¸­å°è£…çš„éå¸¸ç®€æ´ï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹é‡Œé¢åšäº†ä»€ä¹ˆ</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Register</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">driver</span> <span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">Driver</span>) {
	<span style="color:#a6e22e">driversMu</span>.<span style="color:#a6e22e">Lock</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">driversMu</span>.<span style="color:#a6e22e">Unlock</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">driver</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#e6db74">&#34;sql: Register driver is nil&#34;</span>)
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">dup</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">drivers</span>[<span style="color:#a6e22e">name</span>]; <span style="color:#a6e22e">dup</span> {
		panic(<span style="color:#e6db74">&#34;sql: Register called twice for driver &#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">name</span>)
	}
	<span style="color:#a6e22e">drivers</span>[<span style="color:#a6e22e">name</span>] = <span style="color:#a6e22e">driver</span>
}

</code></pre></div><p><code>sql.Register(xxx)</code>å‡½æ•°çš„å®ç°å¦‚ä¸‹ï¼Œæœ‰ä¸¤ä¸ªè¾“å…¥å‚æ•°, ç¬¬ä¸€ä¸ªæ˜¯éœ€è¦æ³¨å†Œçš„æ•°æ®åº“nameï¼Œå¦å¤–ä¸€ä¸ªæ˜¯å®ç°äº†Driverçš„å…·ä½“ç±»å‹ã€‚</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Driver</span> <span style="color:#66d9ef">interface</span> {
	<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">Conn</span>, <span style="color:#66d9ef">error</span>)
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DriverContext</span> <span style="color:#66d9ef">interface</span> {
	<span style="color:#a6e22e">OpenConnector</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">Connector</span>, <span style="color:#66d9ef">error</span>)
}

</code></pre></div><p><code>database/sql</code>å®šä¹‰äº†ä¸€ä¸ªinterface <code>Driver</code>, <code>DriverContext</code>ï¼Œåˆ†åˆ«å®šä¹‰äº†æ–¹æ³• <code>Open()</code>å’Œ<code>OpenConnector()</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Driver</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">log</span> <span style="color:#a6e22e">optionalLogger</span>
	<span style="color:#a6e22e">processQueryText</span> <span style="color:#66d9ef">bool</span>
}
<span style="color:#75715e">// å®ç°äº†DriverContext
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Driver</span>) <span style="color:#a6e22e">OpenConnector</span>(<span style="color:#a6e22e">dsn</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Connector</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">params</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parseConnectParams</span>(<span style="color:#a6e22e">dsn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Connector</span>{
		<span style="color:#a6e22e">params</span>: <span style="color:#a6e22e">params</span>,
		<span style="color:#a6e22e">driver</span>: <span style="color:#a6e22e">d</span>,
	}, <span style="color:#66d9ef">nil</span>
}
<span style="color:#75715e">// å®ç°äº†Driver
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Driver</span>) <span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">dsn</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">dsn</span>)
}
</code></pre></div><p><code>driverInstance</code>å’Œ<code>driverInstanceNoProcess</code>æˆ‘ä»¬åªéœ€è¦å…³æ³¨å…¶ä¸­ä¸€ä¸ªå³å¯ã€‚ é‚£ä¹ˆåœ¨go-mssqldbä¸­
<code>driverInstance</code>å¯¹åº”äº†ä»€ä¹ˆï¼Ÿ å¯ä»¥çœ‹åˆ°æºç å¦‚ä¸Š:</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">driverName</span>, <span style="color:#a6e22e">dataSourceName</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">DB</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">driversMu</span>.<span style="color:#a6e22e">RLock</span>()
	<span style="color:#a6e22e">driveri</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">drivers</span>[<span style="color:#a6e22e">driverName</span>]
	<span style="color:#a6e22e">driversMu</span>.<span style="color:#a6e22e">RUnlock</span>()
	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">ok</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;sql: unknown driver %q (forgotten import?)&#34;</span>, <span style="color:#a6e22e">driverName</span>)
    }
    <span style="color:#75715e">// æ‹¿åˆ°å¸¦æœ‰ctxçš„DBï¼Œè¿™é‡Œå…¶å®å…¼å®¹äº†ä¹‹å‰çš„ç‰ˆæœ¬
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">driverCtx</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">driveri</span>.(<span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">DriverContext</span>); <span style="color:#a6e22e">ok</span> {
		<span style="color:#a6e22e">connector</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">driverCtx</span>.<span style="color:#a6e22e">OpenConnector</span>(<span style="color:#a6e22e">dataSourceName</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
		}
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">OpenDB</span>(<span style="color:#a6e22e">connector</span>), <span style="color:#66d9ef">nil</span>
    }
    <span style="color:#75715e">// æ‹¿åˆ°driverç‰ˆæœ¬çš„DB
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">OpenDB</span>(<span style="color:#a6e22e">dsnConnector</span>{<span style="color:#a6e22e">dsn</span>: <span style="color:#a6e22e">dataSourceName</span>, <span style="color:#a6e22e">driver</span>: <span style="color:#a6e22e">driveri</span>}), <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>databse/sqlæ‹¿åˆ°äº†go-mssqldbæä¾›çš„driverä¹‹ååšäº†ä»€ä¹ˆï¼Ÿ</p>
<p>çœ‹ä»£ç å¯çŸ¥ï¼Œæ‹¿åˆ°äº†ä¸€ä¸ª<code>*DB</code>å®ä½“ï¼Œè¿™ä¸ªå®ä½“çš„driveréƒ¨åˆ†ç”±ç¬¬ä¸‰æ–¹æä¾›ï¼Œå¯¹äºgo-mssqldbæ¥è®²ï¼Œå…·ä½“çš„è¯´æ˜¯æä¾›äº†driverä»¥åŠé‡Œé¢åŒ…å«çš„Connector</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// database/sqlå®ç°äº†é€šç”¨çš„exec
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DB</span>) <span style="color:#a6e22e">Exec</span>(<span style="color:#a6e22e">query</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) (<span style="color:#a6e22e">Result</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">ExecContext</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">query</span>, <span style="color:#a6e22e">args</span><span style="color:#f92672">...</span>)
}

<span style="color:#75715e">// è¿›åˆ°db.ExecContext
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DB</span>) <span style="color:#a6e22e">ExecContext</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">query</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">...</span><span style="color:#66d9ef">interface</span>{}) (<span style="color:#a6e22e">Result</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">res</span> <span style="color:#a6e22e">Result</span>
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>
    <span style="color:#75715e">// é‡è¯•
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">maxBadConnRetries</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
        <span style="color:#75715e">// æ‰§è¡Œæ–¹æ³•db.exec
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">exec</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">query</span>, <span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">cachedOrNewConn</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">ErrBadConn</span> {
			<span style="color:#66d9ef">break</span>
		}
    }
    <span style="color:#75715e">// é‡è¯•
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">ErrBadConn</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">exec</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">query</span>, <span style="color:#a6e22e">args</span>, <span style="color:#a6e22e">alwaysNewConn</span>)
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">err</span>
}

<span style="color:#75715e">// æ˜¾ç„¶æœ€é‡è¦çš„æ–¹æ³•æ˜¯db.exec
</span><span style="color:#75715e"></span><span style="color:#75715e">// è¿›åˆ°db.exec
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DB</span>) <span style="color:#a6e22e">exec</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">query</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">interface</span>{}, <span style="color:#a6e22e">strategy</span> <span style="color:#a6e22e">connReuseStrategy</span>) (<span style="color:#a6e22e">Result</span>, <span style="color:#66d9ef">error</span>) {
    <span style="color:#75715e">// æ ¹æ®ç­–ç•¥è·å–æ•°æ®åº“è¿æ¥
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// æ³¨æ„ ï¼ï¼ï¼è¿™ä¸ªæ—¶å€™æ‰çœŸæ­£çš„å»è·å–conn
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">dc</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">conn</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">strategy</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
    }
    <span style="color:#75715e">// æ‰§è¡Œqueryè¯­å¥ select top 1 foo, bar from test_table
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">execDC</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">dc</span>, <span style="color:#a6e22e">dc</span>.<span style="color:#a6e22e">releaseConn</span>, <span style="color:#a6e22e">query</span>, <span style="color:#a6e22e">args</span>)
}

</code></pre></div><p>æ—¥å¸¸å¼€å‘è¿‡ç¨‹å½“ä¸­å¸¸ç”¨çš„ä¸¤ç±»æ“ä½œæ˜¯Query/Exec, å°±æ‹¿æ–‡ç« å¼€å¤´çš„<code>db.Query(&quot;select top 1 foo, bar from test_table&quot;)</code>æ¥åˆ†ææ•´ä¸ªæµç¨‹</p>
<p>æˆ‘ä»¬çš„æœŸæœ›æ˜¯è·å¾—fooå’Œbarå¯¹åº”coloumä¸Šçš„valueã€‚</p>
<hr>
<p><img src="/img/golang%E8%BF%9E%E6%8E%A5%E6%B1%A0%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90.jpg" alt="image"></p>
<p>é€šè¿‡ä¸šåŠ¡åœºæ™¯çš„å¸¦å…¥ ï¼Œæˆ‘ä»¬äº†è§£äº†ä¸€ä¸ªæŸ¥è¯¢æœ€ç»ˆä¼šèµ°åˆ°å¦‚ä¸Šçš„<code>db.conn()</code>å’Œ<code>db.exexDC()</code>ï¼Œ</p>
<p>é‚£ä¹ˆå®ƒä»¬ç»å†å°±æ˜¯ä¸Šå›¾æ‰€ç¤ºçš„æµç¨‹å›¾é€»è¾‘ã€‚ä»”ç»†çœ‹è¿™å¼ å›¾ï¼Œå¦‚æœæ•´ä¸ªè¿æ¥æ± ä¸ºç©ºçš„æ—¶å€™ï¼Œå¿…ç„¶éœ€è¦æ–°åˆ›å»ºconn,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DB</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">connector</span> <span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">Connector</span>
    <span style="color:#75715e">// ignore ...
</span><span style="color:#75715e"></span>}
</code></pre></div><p>è¿™æ˜¯database/sqlä¸­<code>*DB</code>çš„å®šä¹‰ï¼Œé‡ç‚¹æ˜¯çœ‹connectorï¼Œé€šè¿‡connectorå‘èµ·<code>Connect()</code>, æ‰èƒ½åˆ›å»ºæœ‰æ•ˆçš„conn</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Driver</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">log</span> <span style="color:#a6e22e">optionalLogger</span>
	<span style="color:#a6e22e">processQueryText</span> <span style="color:#66d9ef">bool</span>
}
<span style="color:#75715e">// å®ç°äº†DriverContext
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Driver</span>) <span style="color:#a6e22e">OpenConnector</span>(<span style="color:#a6e22e">dsn</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Connector</span>, <span style="color:#66d9ef">error</span>) {
    <span style="color:#75715e">// å¿½ç•¥å…·ä½“ä»£ç 
</span><span style="color:#75715e"></span>}
<span style="color:#75715e">// å®ç°äº†Driver
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Driver</span>) <span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">dsn</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">dsn</span>)
}
</code></pre></div><p>è¿™é‡Œå°±ç¨å¾®æœ‰ä¸€ç‚¹ä¸åŒäº†ï¼Œä»ä»£ç ä¸­å¯ä»¥çœ‹å‡º, ç¬¬ä¸‰æ–¹æä¾›çš„driveræœ‰ä¸¤ä¸ªï¼Œå¹¶ä¸”è¿”å›çš„å‚æ•°éƒ½ä¸ä¸€è‡´
ä¸€ä¸ªç›´æ¥æä¾›äº†connectorï¼Œå¦å¤–ä¸€ä¸ªæ”¯æŒæä¾›æœ‰æ•ˆçš„conn</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">driverName</span>, <span style="color:#a6e22e">dataSourceName</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">DB</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">driversMu</span>.<span style="color:#a6e22e">RLock</span>()
	<span style="color:#a6e22e">driveri</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">drivers</span>[<span style="color:#a6e22e">driverName</span>]
	<span style="color:#a6e22e">driversMu</span>.<span style="color:#a6e22e">RUnlock</span>()
	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">ok</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;sql: unknown driver %q (forgotten import?)&#34;</span>, <span style="color:#a6e22e">driverName</span>)
	}

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">driverCtx</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">driveri</span>.(<span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">DriverContext</span>); <span style="color:#a6e22e">ok</span> {
        <span style="color:#75715e">// æ”¯æŒæä¾›äº†connector
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">connector</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">driverCtx</span>.<span style="color:#a6e22e">OpenConnector</span>(<span style="color:#a6e22e">dataSourceName</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
		}
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">OpenDB</span>(<span style="color:#a6e22e">connector</span>), <span style="color:#66d9ef">nil</span>
	}
    <span style="color:#75715e">// é€šè¿‡dsnConnectoræä¾›connector
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">OpenDB</span>(<span style="color:#a6e22e">dsnConnector</span>{<span style="color:#a6e22e">dsn</span>: <span style="color:#a6e22e">dataSourceName</span>, <span style="color:#a6e22e">driver</span>: <span style="color:#a6e22e">driveri</span>}), <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>æ³¨å†Œåˆ°<code>*DB</code>å®ä½“ä¸­çš„connectoræ˜¯ä¸åŒçš„ï¼Œdrivercontextç›´æ¥æä¾›äº†Connectorï¼Œå¹¶ä¸”å…¶å®ç°äº†å’Œæ•°æ®åº“é€šä¿¡çš„Connect()æ–¹æ³•</p>
<p>ä½†æ˜¯Driverå¹¶æ²¡æœ‰æä¾›Connectorï¼Œè¿™æ˜¯å› ä¸ºåœ¨database/sqlä¸­åŒ…äº†ä¸€å±‚ï¼Œä¹Ÿå°±æ˜¯dsnConnector</p>
<p>è¿™é‡Œçš„å·®è·æˆ‘è®¤ä¸ºæ˜¯ä»£ç è¿­ä»£è¿‡ç¨‹ä¸­çš„å…¼å®¹æ‰€å¯¼è‡´çš„</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">DB</span>) <span style="color:#a6e22e">conn</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">strategy</span> <span style="color:#a6e22e">connReuseStrategy</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">driverConn</span>, <span style="color:#66d9ef">error</span>) {
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">ci</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">connector</span>.<span style="color:#a6e22e">Connect</span>(<span style="color:#a6e22e">ctx</span>)
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>}
</code></pre></div><p>å¯ä»¥çœ‹è§å…·ä½“çš„<code>Connect()</code>æ•°æ®åº“çš„æ–¹æ³•éƒ½æ˜¯é€šè¿‡æ³¨å…¥åˆ°database/sqlçš„connectorå®ç°çš„</p>
<p>å…·ä½“åˆ°driverctxå’Œdriveræ˜¾ç„¶æ˜¯ä¸åŒçš„</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Connect to the server and return a TDS connection.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Connector</span>) <span style="color:#a6e22e">Connect</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>) (<span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">connect</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">params</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">ResetSession</span>(<span style="color:#a6e22e">ctx</span>)
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span>
}
</code></pre></div><p>driverCtxç›´æ¥å¯ä»¥é€šè¿‡<code>Connect(ctx context.Context)</code>è·å–æœ‰æ•ˆçš„connï¼Œ</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">dsnConnector</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">dsn</span>    <span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">driver</span> <span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">Driver</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">t</span> <span style="color:#a6e22e">dsnConnector</span>) <span style="color:#a6e22e">Connect</span>(<span style="color:#a6e22e">_</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>) (<span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">dsn</span>)
}
</code></pre></div><p>driverå¦‚ä½•è·å–æœ‰æ•ˆçš„connå‘¢ï¼Œé‚£å°±è¦ä»dsnConnectoræ¥è®²äº†ï¼Œè½¬æ¢ä¸€ä¸‹ <code>db.connector.Connect() == db.dsnConnector.Connect()</code>
å¯ä»¥çœ‹åˆ°æœ€ç»ˆè°ƒç”¨äº†t.driver.Open(t.dsn)ï¼Œ ä¹Ÿå°±æ˜¯è¯´åˆå›åˆ°äº†ç¬¬ä¸‰æ–¹æä¾›çš„ driverä¸Šï¼ˆæ³¨æ„ä¸æ˜¯driverctxï¼‰ï¼Œ
ä»database/sqlçš„driverå®šä¹‰å¯çŸ¥é“ï¼Œç¬¬ä¸‰æ–¹driverï¼ˆgo-mssqldbçš„æ³¨å†Œçš„driverï¼‰ï¼Œå¿…é¡»å®ç°äº†<code>Open()</code>ï¼Œäº‹å®ä¸Šä¹Ÿç¡®è®¤å®ç°äº†è¿™ä¸ªæ–¹æ³•ã€‚
ä¹Ÿå°±æ˜¯:</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
<span style="color:#75715e">// t.driver.Open(t.dsn)å‘èµ·
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Driver</span>) <span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">dsn</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">driver</span>.<span style="color:#a6e22e">Conn</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>(), <span style="color:#a6e22e">dsn</span>)
}

<span style="color:#75715e">// åˆ†ææ•°æ®åº“å‚æ•°ï¼Œ æ‰§è¡Œè¿æ¥ç¨‹åºï¼Œè·å– conn
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Driver</span>) <span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">dsn</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Conn</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">params</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parseConnectParams</span>(<span style="color:#a6e22e">dsn</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">d</span>.<span style="color:#a6e22e">connect</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">params</span>)
}
</code></pre></div><p>ç»ˆäºå¾—åˆ°äº†ä¸€ä¸ªconnï¼Œ å¹¶ä¸”database/sqlç»´æŠ¤äº†ä¸€ä¸ªconnçš„è¿æ¥æ± ï¼Œå‰æ–‡ä¸­æåˆ°çš„db.execDC, å°±è´Ÿè´£å°†å‚æ•°æ³¨å…¥åˆ°cmderï¼ˆæ˜¯æˆ‘ç”Ÿé€ çš„è¯ï¼‰ä¸­ï¼Œ</p>
<p>cmderè§£ææˆsql serveråè®®å®šä¹‰çš„å­—èŠ‚æµï¼Œgo-mssqldbè´Ÿè´£send/receiverï¼Œ database/sqlè´Ÿè´£ç”Ÿæˆæ•°æ®ï¼Œæ¯”å¦‚fooï¼Œ bar</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"> <span style="color:#75715e">// æ‰§è¡Œqueryè¯­å¥ select top 1 foo, bar from test_table
</span><span style="color:#75715e"></span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">execDC</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#a6e22e">dc</span>, <span style="color:#a6e22e">dc</span>.<span style="color:#a6e22e">releaseConn</span>, <span style="color:#a6e22e">query</span>, <span style="color:#a6e22e">args</span>)
</code></pre></div><p>ç»¼ä¸Šï¼Œå°±æ˜¯å¦‚ä½•ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“è¿›è¡ŒæŸ¥è¯¢çš„æµç¨‹ï¼Œå†™å…¥æ˜¯ä¸€æ ·çš„åŸç†ï¼Œè¿™é‡Œä¸èµ˜è¿°ï¼Œå¦‚æœä½ çœ‹åˆ°äº†è¿™é‡Œï¼Œä½ è‚¯å®šä¼šæœ‰ä¸€äº›è‡ªå·±çš„çœ‹æ³• ã€‚</p>
<p>æˆ‘è§‰å¾—database/sqlæä¾›äº†é€šç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç»´æŠ¤è¿æ¥æ± ï¼Œæ‰§è¡Œquery/execï¼Œæ³¨å†Œï¼Œæ•°æ®è½¬æ¢
ç¬¬ä¸‰åº“ï¼Œå…¶å®ä¹Ÿå¯ä»¥å«åšpackageï¼Œå®ç°database/sqlå®šä¹‰çš„Driver, ç„¶åRegister,å°±è½»æ¾çš„è¿æ¥åˆ°äº†sqlä¸Š</p>
<p>ç»†èŠ‚ä¸Šçš„åè®®è§£æï¼Œå‘èµ·è¿æ¥ï¼ˆé•¿è¿æ¥ï¼‰ï¼Œéƒ½ä¾é è‡ªèº«æ¥è§£å†³</p>
<p>è¿™å°±åƒæ˜¯OSIç½‘ç»œæ¨¡å‹ï¼Œ åˆåˆ†å±‚çš„æ„Ÿè§‰åœ¨é‡Œé¢ï¼Œ ä»»ä½•ä¸€å±‚æœ‰æ”¹åŠ¨åªéœ€è¦åŠ¨å…¶ä¸­ä¸€å±‚å³å¯</p>
<p>ä½†æ˜¯ä¸èƒ½è¯´è¿™æ ·æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ¯”å¦‚driverå’Œdriverctxæ˜¾ç„¶æ˜¯å…¼å®¹ä¹‹åçš„ç»“æœï¼Œå¯¼è‡´é˜…è¯»ä»£ç çš„æ—¶å€™éœ€è¦æ¥å›å»çœ‹</p>
<p>æ€»ä½“è€Œè¨€golang database/sqlçš„å®ç°æ˜¯éå¸¸æœ‰å€Ÿé‰´å’Œå­¦ä¹ çš„æ„ä¹‰ï¼Œ æœ›ä¸€èµ·åŠªåŠ›ï¼ï¼ï¼ğŸ’ªğŸ’ªğŸ’ªã€‚</p>
</div>


    </main>

    
  </body>
</html>
